/* ===== Liquid Glass · iOS-26 (light-only) =====
   Полная замена стилей под «liquid glass» без изменения разметки.
   Сохраняем существующие классы и поведение.
*/

/* ---------- Токены (локально и безопасно) ---------- */
:root {
  /* макс. ширина шапки/окна/композера в чате */
  --chat-max: 720px;

  /* бренд */
  --brand: #8d2828;
  --brand-ink: #ffffff;
  --brand-10: color-mix(in oklab, var(--brand) 10%, #ffffff);
  --brand-stroke: color-mix(in oklab, var(--brand) 52%, #ffffff);

  /* текст */
  --ink: #0f172a;
  --muted: #6b7280;

  /* стекло */
  --lg-blur: 14px;
  --glass-bg: color-mix(in oklab, #ffffff 70%, var(--brand-10));
  --glass-soft: color-mix(in oklab, #ffffff 82%, var(--brand-10));
  --glass-stroke: color-mix(in oklab, var(--brand-stroke) 38%, #e5e7eb 62%);
  --glass-shadow-sm: 0 8px 18px rgba(15,23,42,.10);
  --glass-shadow-md: 0 12px 32px rgba(15,23,42,.12);
  --glass-inset: inset 0 1px 0 rgba(255,255,255,.66), inset 0 -1px 0 rgba(0,0,0,.04);

  /* кольцо фокуса */
  --ring: color-mix(in oklab, var(--brand) 24%, transparent);
}

@media (max-width: 768px) {
  :root { --chat-max: 100%; }
}

/* ---------- Общие компоненты ---------- */
.card {
  border: 1px solid var(--glass-stroke);
  border-radius: 16px;
  background: linear-gradient(180deg, var(--glass-soft), var(--glass-bg));
  -webkit-backdrop-filter: blur(var(--lg-blur)) saturate(1.15);
  backdrop-filter: blur(var(--lg-blur)) saturate(1.15);
  padding: 12px;
  box-shadow: var(--glass-shadow-sm), var(--glass-inset);
  color: var(--ink);
}

/* Primary button — бордовый глянец */
.btnPrimary {
  display: inline-flex; align-items: center; justify-content: center;
  height: 36px; padding: 0 14px; border-radius: 12px;
  border: 1px solid var(--brand-stroke);
  background:
    linear-gradient(180deg,
      color-mix(in oklab, #ffffff 10%, var(--brand)) 0%,
      color-mix(in oklab, #000000 12%, var(--brand)) 100%);
  color: #fff; font-size: 14px; font-weight: 800; cursor: pointer;
  -webkit-backdrop-filter: blur(10px) saturate(1.2);
  backdrop-filter: blur(10px) saturate(1.2);
  box-shadow: 0 12px 22px rgba(141,40,40,.24), inset 0 1px 0 rgba(255,255,255,.60);
  transition: transform .06s ease, box-shadow .16s ease, filter .14s ease;
}
.btnPrimary:hover { transform: translateY(-1px); box-shadow: 0 14px 26px rgba(141,40,40,.28), inset 0 1px 0 rgba(255,255,255,.66); }
.btnPrimary:active { transform: translateY(0); }
.btnPrimary:disabled { opacity:.7; cursor: default; box-shadow: none; }

/* Danger (контурный) — стеклянная капсула */
.btnDanger{
  display:inline-flex;align-items:center;justify-content:center;
  height:32px;padding:0 12px;border-radius:12px;
  border:1px solid color-mix(in oklab, #7f1d1d 55%, #ffffff);
  background:
    linear-gradient(180deg, color-mix(in oklab,#ffffff 92%, transparent), color-mix(in oklab,#ffffff 84%, transparent));
  color:#7f1d1d; font-weight:800;
  -webkit-backdrop-filter: blur(8px) saturate(1.1);
  backdrop-filter: blur(8px) saturate(1.1);
  box-shadow: var(--glass-shadow-sm), inset 0 1px 0 rgba(255,255,255,.6);
}

/* Статусные бейджи — мягкое стекло */
.statusBadge{
  display:inline-flex;align-items:center;gap:6px;
  height:22px;padding:0 10px;border-radius:9999px;font-size:12px;
  border:1px solid var(--glass-stroke);
  background: linear-gradient(180deg, color-mix(in oklab,#ffffff 94%, transparent), color-mix(in oklab,#ffffff 86%, transparent));
  -webkit-backdrop-filter: blur(8px) saturate(1.1);
  backdrop-filter: blur(8px) saturate(1.1);
  color:#374151; box-shadow: inset 0 1px 0 rgba(255,255,255,.75);
}
.status-new        { border-color:#bfdbfe; background: linear-gradient(180deg,#f3f8ff,#eff6ff); }
.status-in_progress{ border-color:#fde68a; background: linear-gradient(180deg,#fff7df,#fffbeb); }
.status-done       { border-color:#bbf7d0; background: linear-gradient(180deg,#edfdf4,#f0fdf4); }
.status-rejected   { border-color:#fecaca; background: linear-gradient(180deg,#fff6f6,#fef2f2); }

/* ---------- Страница чата заявки ---------- */
.reqChatPage{
  display:grid;grid-template-rows:auto 1fr auto;gap:12px;
  min-height:calc(100vh - 24px);
}

/* одна ширина для шапки, ленты и композера */
.chatHeader.card, .chatWindow.card, .composer.card {
  width:min(var(--chat-max), 100%);
  margin-inline:auto;
}

/* Шапка — стекло + липкая */
.chatHeader{ position:sticky; top:0; z-index:2; }
.chatHeaderRow{ display:flex; align-items:center; justify-content:space-between; gap:12px; }
.chatHeaderRight{ display:flex; align-items:center; gap:8px; }
.chatTitle{ margin:0; font-size:20px; font-weight:800; line-height:1.2; color:var(--ink); }
.chatMeta{ margin-top:6px; font-size:12px; color:var(--muted); }

/* Окно чата */
.chatWindow{
  display:flex; flex-direction:column; gap:8px; padding:12px; overflow:auto;
  border-radius:16px;
  background: linear-gradient(180deg, color-mix(in oklab,#ffffff 94%, transparent), color-mix(in oklab,#ffffff 86%, transparent));
  -webkit-backdrop-filter: blur(10px) saturate(1.1);
  backdrop-filter: blur(10px) saturate(1.1);
}
.emptyMuted{ color:#6b7280; font-size:13px; text-align:center; padding:16px 0; }

/* Разделитель дат */
.dateDivider{ display:flex; justify-content:center; margin:6px 0; }
.dateDivider>span{
  font-size:12px; color:#6b7280;
  background: linear-gradient(180deg,#f9fafb,#f3f4f6);
  border:1px solid var(--glass-stroke);
  border-radius:9999px; padding:2px 8px;
  -webkit-backdrop-filter: blur(8px); backdrop-filter: blur(8px);
}

/* Пузыри сообщений — стекло/глянец */
.msg{
  max-width:min(54%, 500px);
  margin:3px 0; padding:8px 12px 16px;
  font-size:14px; line-height:1.4; position:relative;
  overflow-wrap:anywhere; word-break:break-word; hyphens:auto;
  box-shadow: 0 1px 0 rgba(0,0,0,.04);
  -webkit-backdrop-filter: blur(8px) saturate(1.05);
  backdrop-filter: blur(8px) saturate(1.05);
}
@media (max-width: 640px){ .msg{ max-width:82%; } }

/* peer — светлое стекло, me — бордовый глянец */
.msg-peer{
  align-self:flex-start;
  color:#111827;
  background: linear-gradient(180deg,#eef2f7,#e9eef6);
  border:1px solid color-mix(in oklab, #93a3b8 40%, #ffffff);
  border-radius:16px 16px 16px 6px; margin-right:auto;
  box-shadow: var(--glass-shadow-sm), inset 0 1px 0 rgba(255,255,255,.75);
}
.msg-me{
  align-self:flex-end; margin-left:auto;
  color:#fff;
  background:
    linear-gradient(180deg,
      color-mix(in oklab,#ffffff 10%, var(--brand)) 0%,
      color-mix(in oklab,#000000 12%, var(--brand)) 100%);
  border:1px solid var(--brand-stroke);
  border-radius:16px 16px 6px 16px;
  box-shadow: 0 10px 22px rgba(141,40,40,.22), inset 0 1px 0 rgba(255,255,255,.5);
}

.msgHead{ font-size:12px; font-weight:700; margin-bottom:2px; color:#374151; }
.msg-me .msgHead{ display:none; }
.msgBody{ white-space:pre-wrap; }

/* Время внизу справа */
.msgTime{ position:absolute; bottom:2px; right:8px; font-size:11px; line-height:1; color:rgba(0,0,0,.45); }
.msg-me .msgTime{ color:rgba(255,255,255,.78); }

/* Системное (первое) сообщение */
.msg-system{
  align-self:center; max-width:min(80%,600px);
  background: linear-gradient(180deg, color-mix(in oklab,#ffffff 96%, transparent), color-mix(in oklab,#ffffff 88%, transparent));
  border:1px dashed var(--glass-stroke);
  border-radius:16px; color:#374151;
  -webkit-backdrop-filter: blur(8px) saturate(1.05);
  backdrop-filter: blur(8px) saturate(1.05);
}
.msg-system .msgTime{
  position:static; display:block; text-align:right; margin-top:4px; font-size:11px; color:#6b7280;
}

/* Композер — стекло с липким позиционированием */
.composer{
  padding:8px; position:sticky; bottom:0; z-index:2;
  border-radius:16px;
  background: linear-gradient(180deg, var(--glass-soft), var(--glass-bg));
  border:1px solid var(--glass-stroke);
  box-shadow: var(--glass-shadow-md), var(--glass-inset);
  -webkit-backdrop-filter: blur(var(--lg-blur)) saturate(1.15);
  backdrop-filter: blur(var(--lg-blur)) saturate(1.15);
}
.composerForm{ display:grid; grid-template-columns:1fr auto; gap:8px; align-items:end; }

/* авто-рост: только визуал/фокус */
.composerInput{
  width:100%;
  border:1px solid var(--glass-stroke); border-radius:12px;
  padding:10px 12px; font:inherit;
  min-height:44px; max-height:160px; overflow:auto; resize:none;
  background: linear-gradient(180deg, color-mix(in oklab,#ffffff 94%, transparent), color-mix(in oklab,#ffffff 86%, transparent));
  line-height:1.4; color:var(--ink);
  -webkit-backdrop-filter: blur(8px) saturate(1.05);
  backdrop-filter: blur(8px) saturate(1.05);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.75);
  transition: box-shadow .16s ease, border-color .14s ease, background .16s ease;
}
.composerInput:focus{
  outline:none;
  border-color: var(--brand-stroke);
  box-shadow: 0 0 0 4px var(--ring), inset 0 1px 0 rgba(255,255,255,.8);
}
.composerSend{ height:44px; padding:0 16px; border-radius:12px; width:auto; white-space:nowrap; }

/* ---------- Список заявок и форма создания ---------- */
.req-page{ display:grid; grid-template-columns:1fr 360px; gap:12px; align-items:start; }
@media (max-width:1100px){ .req-page{ grid-template-columns:1fr; } }
.left,.right{ min-width:0; }

.reqList{ display:grid; gap:8px; }

/* Строка заявки — стеклянная плитка */
.reqRow{
  display:grid; gap:4px; padding:10px 12px;
  border:1px solid var(--glass-stroke); border-radius:12px;
  background: linear-gradient(180deg, var(--glass-soft), var(--glass-bg));
  text-decoration:none; color:inherit;
  -webkit-backdrop-filter: blur(10px) saturate(1.1);
  backdrop-filter: blur(10px) saturate(1.1);
  box-shadow: var(--glass-shadow-sm), var(--glass-inset);
  transition: transform .06s ease, box-shadow .16s ease, border-color .14s ease, background .16s ease;
}
.reqRow:hover{
  transform: translateY(-1px);
  border-color: var(--brand-stroke);
  background: linear-gradient(180deg,
    color-mix(in oklab, var(--brand) 4%, #ffffff),
    color-mix(in oklab, var(--brand) 2%, #ffffff));
  box-shadow: 0 12px 24px rgba(15,23,42,.12), var(--glass-inset);
}
.reqRowTop{ display:flex; align-items:center; justify-content:space-between; gap:8px; }
.reqRowTitle{ font-weight:700; font-size:14px; line-height:1.3; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; min-width:0; }
.reqRowSub{ display:flex; align-items:center; gap:6px; color:var(--muted); font-size:12px; }
.subItem{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.dot{ opacity:.7; }

/* Карточка формы создания — стекло */
.reqChatPage .card,
.right .card,
.left .card,
.createForm .card { border-radius:16px; }

/* Поля формы — стеклянный ввод */
.createForm{ display:grid; gap:12px; }
.field{ display:grid; gap:6px; }
.label{ font-size:13px; color:#374151; }
.input,.textarea{
  display:block; width:100%; box-sizing:border-box;
  border:1px solid var(--glass-stroke); border-radius:12px; padding:10px 12px; font:inherit;
  background: linear-gradient(180deg, color-mix(in oklab,#ffffff 94%, transparent), color-mix(in oklab,#ffffff 86%, transparent));
  -webkit-backdrop-filter: blur(8px) saturate(1.05);
  backdrop-filter: blur(8px) saturate(1.05);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.75);
  transition: box-shadow .16s ease, border-color .14s ease, background .16s ease;
}
.textarea{ resize:vertical; min-height:96px; }
.input:focus,.textarea:focus{
  outline:none; border-color: var(--brand-stroke);
  box-shadow: 0 0 0 4px var(--ring), inset 0 1px 0 rgba(255,255,255,.8);
}

/* Мини-бейдж адресата — стекло */
.miniBadge{
  display:inline-flex; align-items:center; height:20px; padding:0 8px; border-radius:9999px;
  font-size:12px; font-weight:700; line-height:1;
  border:1px solid var(--glass-stroke);
  background: linear-gradient(180deg, color-mix(in oklab,#ffffff 94%, transparent), color-mix(in oklab,#ffffff 86%, transparent));
  -webkit-backdrop-filter: blur(8px) saturate(1.1);
  backdrop-filter: blur(8px) saturate(1.1);
  color:#374151; box-shadow: inset 0 1px 0 rgba(255,255,255,.75);
}
.miniBadge.target-deputy{
  color: var(--brand);
  border-color: color-mix(in oklab, var(--brand) 32%, #f3c5c5);
  background: linear-gradient(180deg,#fff6f6,#fdf2f2);
}
.miniBadge.target-sysadmin{
  color:#1d4ed8;
  border-color:#c7d2fe;
  background: linear-gradient(180deg,#f6f9ff,#eff6ff);
}

/* ---------- Декор и доступность ---------- */
.emptyMuted,
.reqRowSub,
.chatMeta { -webkit-font-smoothing: antialiased; }

:where(button, .btnPrimary, .btnDanger, .reqRow, .composerInput, .input, .textarea) { outline: none; }
:where(button, .btnPrimary, .btnDanger, .reqRow, .composerInput, .input, .textarea):focus-visible {
  box-shadow: 0 0 0 4px var(--ring), inset 0 1px 0 rgba(255,255,255,.8);
  border-color: var(--brand-stroke);
}

/* Уважение настроек пользователя */
@media (prefers-reduced-motion: reduce) {
  .btnPrimary, .reqRow { transition: none; transform: none; }
}
